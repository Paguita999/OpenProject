<!DOCTYPE html>
<html lang="en">

<head>
    <title>AUTIS</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AUTIS">
    <meta name="keywords" content="AUTIS">
    <meta name="author" content="AUTIS Team">

    <link rel="stylesheet" href="../css/index.css">
</head>

<body id="index">
    <main>
        <h1> O P E N P R O J E C T<br>
            A U T I S
        </h1>

        <form id="apiform">
            <label id="labelform" for="apikey">Apikey:</label>
            <input type="text" id="apikey" name="apikey" placeholder="Enter your API key..." maxlength="150" required>
            <span id="apikeyErr" class="error"></span><br><br>

            <button type="submit" id="submit">Submit</button>
        </form>

        <script> document.querySelector('#apiform').addEventListener('submit', async (e) => {
                e.preventDefault();
                const key = document.querySelector('#apikey').value.trim();
                const errorElement = document.querySelector('#apikeyErr');

                if (!key) {
                    errorElement.innerHTML = "Camp required";
                    return;
                }

                try {
                    const response = await fetch('http://localhost:8080/api/v3/users', {
                        method: 'GET',
                        headers: {
                            'Authorization': 'Basic ' + btoa('apikey:' + key),
                            'Content-Type': 'application/json',
                            'Origin': 'http://localhost:8080'
                        }
                    });

                    if (response.ok) {
                        sessionStorage.setItem("apikey", key);
                        window.location.href = '/html/inicio.html';
                    } else {
                        errorElement.innerHTML = 'Invalid key';
                    }
                } catch (err) {
                    console.error('Connection error:', err);
                    errorElement.innerHTML = 'Server error connection';
                }
            });
        </script>

    </main>
</body>

</html>